{"version":3,"sources":["../src/Rollbar.js"],"names":[],"mappings":"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","file":"Rollbar.js","sourcesContent":["import { Platform, NativeModules } from 'react-native';\n\nimport Rollbar from 'rollbar/src/react-native/rollbar';\n\nimport { merge } from '../src/merge';\n\nconst NativeClient = NativeModules.RollbarReactNative;\n\nexport class Client {\n  constructor(config) {\n    if (config instanceof Configuration) {\n      this.config = config;\n    } else {\n      this.config = new Configuration(config);\n    }\n    this.config.setPlatform(Platform.OS);\n\n    this.rollbar = new Rollbar(this.config.toJSON());\n\n    if (NativeClient) {\n      NativeClient.init(this.config.toJSON());\n    }\n\n    this.captureUncaughtExceptions();\n    if (this.config.captureUnhandledRejections) {\n      this.captureUnhandledRejections();\n    }\n  }\n\n  captureUncaughtExceptions = () => {\n\t\tif (ErrorUtils) {\n      const previousHandler = ErrorUtils.getGlobalHandler();\n\n      ErrorUtils.setGlobalHandler((error, isFatal) => {\n        if (this.config.captureUncaught && this.config.shouldSend()) {\n          this.error(error, undefined, (queued) => {\n            if (previousHandler) {\n              previousHandler(error, isFatal);\n            }\n          });\n        } else if (previousHandler) {\n          previousHandler(error, isFatal);\n        }\n      });\n    }\n  }\n\n  captureUnhandledRejections = () => {\n\t\tconst tracking = require('promise/setimmediate/rejection-tracking');\n    const client = this;\n    tracking.enable({\n      allRejections: true,\n      onUnhandled: function(id, error) { client.error(error); },\n      onHandled: function() {}\n    });\n  }\n\n  log = (obj, extra, callback) => {\n\t\tif (!this.config.shouldSend()) {\n      if (callback) {\n        callback(false);\n      }\n      return;\n    }\n\n    this.rollbar.log(obj, extra, callback);\n  }\n\n  debug = (obj, extra, callback) => {\n    return this.rollbar.debug(obj, extra, callback);\n  }\n\n  info = (obj, extra, callback) => {\n    return this.rollbar.info(obj, extra, callback);\n  }\n\n  warning = (obj, extra, callback) => {\n    return this.rollbar.warning(obj, extra, callback);\n  }\n\n  error = (obj, extra, callback) => {\n    return this.rollbar.error(obj, extra, callback);\n  }\n\n  critical = (obj, extra, callback) => {\n    return this.rollbar.critical(obj, extra, callback);\n  }\n\n  setPerson = (id, name, email) => {\n    this.rollbar.setPerson({id, name, email});\n    if (NativeClient) {\n      NativeClient.setPerson({id, name, email});\n    }\n  }\n\n  clearPerson = () => {\n    this.rollbar.clearPerson();\n    if (NativeClient) {\n      NativeClient.clearPerson();\n    }\n  }\n}\n\nexport class Configuration {\n  constructor(accessToken, options) {\n    options = options || {};\n    const pkgData = require('../package.json');\n    this.version = pkgData['version'];\n    this.accessToken = accessToken;\n    this.environment = options.environment;\n    this.logLevel = options.logLevel || 'debug';\n    this.reportLevel = options.reportLevel || undefined;\n    this.endpoint = options.endpoint || undefined;\n    this.appVersion = options.appVersion || undefined;\n    this.codeBundleId = options.codeBundleId || undefined;\n    this.releaseStage = options.releaseStage || undefined;\n    this.enabledReleaseStages = options.enabledReleaseStages || undefined;\n    this.captureUncaught = options.captureUncaught !== undefined ? options.captureUncaught : true;\n    this.captureUnhandledRejections = options.captureUnhandledRejections !== undefined ? options.captureUnhandledRejections : !__DEV__;\n\n    // Ensure captureDeviceInfo is set before calling payloadOptions() below.\n    this.captureDeviceInfo = options.captureDeviceInfo === undefined ? false : options.captureDeviceInfo;\n    this.payload = merge(options.payload, this.payloadOptions());\n    this.enabled = options.enabled === undefined ? true : options.enabled;\n    this.verbose = options.verbose || false;\n    this.transform = options.transform;\n    this.rewriteFilenamePatterns = options.rewriteFilenamePatterns;\n    this.scrubFields = options.scrubFields || undefined;\n    this.overwriteScrubFields = options.overwriteScrubFields || undefined;\n    this.onSendCallback = options.onSendCallback || undefined;\n    this.checkIgnore = options.checkIgnore || undefined;\n    this.ignoreDuplicateErrors = options.ignoreDuplicateErrors !== undefined ? options.ignoreDuplicateErrors : undefined;\n  }\n\n  shouldSend = () => {\n    return !this.releaseStage ||\n      !this.enabledReleaseStages ||\n      this.enabledReleaseStages.includes(this.releaseStage);\n  }\n\n  setPlatform = (platform) => {\n    if (this.platform === undefined) {\n      if (platform === 'ios' || platform === 'android') {\n        this.platform = platform;\n      } else {\n        this.platform = 'client';\n      }\n    }\n  }\n\n  payloadOptions = () => {\n    if (!this.captureDeviceInfo) {\n      return {};\n    }\n\n    return {\n      client: {\n        os: this.deviceAttributes()\n      }\n    }\n  }\n\n  deviceAttributes = () => {\n    if (NativeClient) {\n      return JSON.parse(NativeClient.deviceAttributes());\n    } else {\n      return {};\n    }\n  }\n\n  toJSON = () => {\n    var result = {\n      accessToken: this.accessToken,\n      endpoint: this.endpoint,\n      platform: this.platform,\n      logLevel: this.logLevel,\n      reportLevel: this.reportLevel,\n      enabled: this.enabled,\n      verbose: this.verbose,\n      captureDeviceInfo: this.captureDeviceInfo,\n      transform: this.transform,\n      rewriteFilenamePatterns: this.rewriteFilenamePatterns,\n      scrubFields: this.scrubFields,\n      overwriteScrubFields: this.overwriteScrubFields,\n      onSendCallback: this.onSendCallback,\n      checkIgnore: this.checkIgnore,\n      ignoreDuplicateErrors: this.ignoreDuplicateErrors,\n      payload: {\n        codeBundleId: this.codeBundleId,\n        releaseStage: this.releaseStage,\n        enabledReleaseStages: this.enabledReleaseStages,\n        appVersion: this.appVersion,\n        ...this.payload\n      },\n      notifier: {\n        name: 'rollbar-react-native',\n        version: this.version\n      }\n    };\n    if (this.environment) {\n      result.environment = this.environment;\n    }\n    return result;\n  }\n}\n"]}